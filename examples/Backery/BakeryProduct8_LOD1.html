<!DOCTYPE html>
 <html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Backer_8</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="../css/styles.css">
    </head>
    <body>
        <div id="scene-container">
        </div>
        
        <script type="module">
            
            import * as THREE from '../../build/three.module.js';

            import { OrbitControls } from '../jsm/controls/OrbitControls.js';
            import { GLTFLoader } from '../jsm/loaders/GLTFLoader.js';


            let container = document.querySelector('#scene-container');
            
            let container_width = container.offsetWidth;
            let container_height = container.offsetHeight;

            let controls;

            let scene, camera, renderer;
            let group = new THREE.Group();

            //建立場景
            function init(){

                scene = new THREE.Scene();
                scene.background = new THREE.Color( 0xffffff );
                // scene.fog = new THREE.Fog( 0xcccccc, 100, 1500 );

                createCamera();
                createLights();
                loadingModel();
                createRenderer();
                createControls();
                createEvent();
                
                renderer.setAnimationLoop( ( )=> {

                    update();
                    render();

                });
            }

            //創建相機
            function createCamera(){

                let fov = 30;
                let aspect = container_width / container_height;
                let near = 1;
                let far = 2000;
                camera = new THREE.PerspectiveCamera( fov, aspect, near, far );
                camera.position.set( 5, 30, 30 );


            }

            //創建光源
            function createLights(){

                scene.add( new THREE.AmbientLight( 0xffffff, 0.7 ) );

                let dirLight = new THREE.DirectionalLight( 0xffffff, 0.7 );
                dirLight.position.set( 0, 1, 0 );
                scene.add( dirLight );

                let pointLight = new THREE.PointLight( 0xffffff );
                pointLight.position.set( -15, 5, 5 );
                scene.add( pointLight );

            }

            function loadingModel(){

                let loader = new THREE.TextureLoader();

                let gltfLoader = new GLTFLoader();
                gltfLoader.load( '../models/gltf/test/BakeryProduct2test/BakeryProduct8_LOD1.gltf', function ( gltf ) {

                    console.log( gltf.scene.children );

                    gltf.scene.traverse( function( child ){

                        if( child.isMesh ){


                            child.scale.set( 160, 160, 160 );

                        }

                    } );

                    group.add( gltf.scene );

                    scene.add( group );

                } );

            }

            //實現渲染
            function createRenderer(){

                renderer = new THREE.WebGLRenderer();
                renderer.setSize( container_width, container_height );
                renderer.setPixelRatio( window.devicePixelRatio );

                container.appendChild( renderer.domElement );

            }

            //實現控制
            function createControls(){

                controls = new OrbitControls( camera, renderer.domElement );
                controls.target.set( 0, 3, 0 );

            }

            //創建事件
            function createEvent(){

                window.addEventListener('resize', onWindowResize, false);

            }

            //設備視窗更新
            function onWindowResize(){

                container_width = container.offsetWidth;
                container_height = container.offsetHeight;

                let aspect = container_width / container_height;

                camera.aspect = aspect;
                camera.updateProjectionMatrix();
                
                renderer.setSize( container_width, container_height );

                // controls.handleResize();

                // render();

            }

            //Object事件
            function update(){

                group.rotation.y += 0.01;

            }

            //渲染更新
            function render(){

                controls.update();

                renderer.render( scene, camera );

            }

            init();

        </script>

    </body>
</html>